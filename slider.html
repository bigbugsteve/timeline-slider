<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="./style.css" />
        
        <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"
        ></script>
        <title>Document</title>
    </head>
    <body>
        <div class="container">
            <div class="timeline-header">
                <h3 class="timeline-header-title">
                    Notre Histoire
                </h3>
                <div class="controls">
                    <button class="toggle prev-btn" disabled data-toggle="prev"><-</i></button>
                    <button class="toggle next-btn" data-toggle="next">-></i></button>
                </div>
            </div>
            <div class="wrap">

                <ul class="carousel-all-displayed hide">
                    <li class="carousel-seat-all">
                        <h2 class="year">2020</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2019</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2014</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2012</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2009</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2008</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat-all">
                        <h2 class="year">2004</h2>
                        <span class="circle"></span>
                    </li>
                </ul>
            </div>

            <div class="wrap wrap-detailed">
                <ul class="carousel is-set carousel-detailed">
                    <li class="carousel-seat">
                        <h2 class="year">2020</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat">
                        <h2 class="year">2019</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat">
                        <h2 class="year">2014</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat">
                        <h2 class="year">2012</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat">
                        <h2 class="year">2009</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat">
                        <h2 class="year">2008</h2>
                        <span class="circle"></span>
                    </li>
                    <li class="carousel-seat is-ref">
                        <h2 class="year">2004</h2>
                        <span class="circle"></span>
                    </li>
                </ul>
            </div>
            <ul class="timeline-box-list">
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        Rebranding des activités SAV en Save
                    </h3>
                    <p class="timeline-text">
                        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        Lorem Ipsum is simply dummy text
                    </h3>
                    <p class="timeline-text">
                        It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters, as opposed to using 'Content here, content here', making it look 
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        It is a long established fact that
                    </h3>
                    <p class="timeline-text">
                        Avec 300 magasins de proximité et 8 centres en centralisation, Save est spécialisé dans la réparation, le reconditionnement et le recyclage de produits.
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        Contrary to popular belief, Lorem Ipsum is not simply
                    </h3>
                    <p class="timeline-text">
                        Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        There are many variations of passages2
                    </h3>
                    <p class="timeline-text">
                        All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        There are many variations of passages43
                    </h3>
                    <p class="timeline-text">
                        All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.
                    </p>
                </li>
                <li class="timeline-box">
                    <h3 class="timeline-box-title">
                        There are many variations of passages23423
                    </h3>
                    <p class="timeline-text">
                        All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.
                    </p>
                </li>

                <div class="box-navigation">
                    <div class="details-btn active"><span></span> Détails</div>
                    <div class="tout show-all-btn"><span></span> Tout afficher</div>
                </div>
            </ul>
        </div>
        

        <script>
            // http://madewithenvy.com/ecosystem/articles/2015/exploring-order-flexbox-carousel/

            // Variables
            let activeIndex = 0;                                            // Starts from 0
            const carouselDetailed = document.querySelector('.carousel-detailed');
            const carouselAllDisplayed = document.querySelector('.carousel-all-displayed');
            const timelineTexts = Array.from(document.querySelectorAll('.timeline-text'))
            const seats = document.querySelectorAll('.carousel-seat');                              // Detail Year timeline
            const seatOfShowAllView = Array.from(document.querySelectorAll('.carousel-seat-all'));  // ShowAll Year timeline
            const timelineBoxList = Array.from(document.querySelectorAll('.timeline-box'))          // Timeline Boxes (descr.)
            const boxNavigation = document.querySelector('.box-navigation')
            const seatsArray = Array.from(seats)
            const toggle = document.querySelectorAll('.toggle');
            const showAllBtn = document.querySelector('.show-all-btn')      // Show All Button
            const detailBtn = document.querySelector('.details-btn')        // Details Button
            const prevBtn = document.querySelector('.prev-btn')             // Previous Button
            const nextBtn = document.querySelector('.next-btn')             // Next Button
            
            seatsArray[activeIndex].classList.add('active')                 // Set active on current year || detailed
            seatOfShowAllView[activeIndex].classList.add('active')          // Set active on current year || show all
            timelineBoxList[activeIndex].classList.add('active')            // Show the description that belongs to the active year

            // Array
            let timelineIndexArray = []                                     // Create array to find index of clicked timeline elemnt
            seatOfShowAllView.map((item, index) => {                        // Map through and pick the text
            console.log("🚀 ~ file: slider.html ~ line 186 ~ activeIndex", activeIndex)
                timelineIndexArray.push(item.firstElementChild.innerText)
            })

            // Event listeners
            document.addEventListener("click", delegate(toggleFilter, toggleHandler));

            // Show all view of timeline
            seatOfShowAllView.forEach(item => {
                item.addEventListener('click', function (e) {
                    let oldIndex = activeIndex  
                    let clickedText = e.target.innerText
                    let index = timelineIndexArray.indexOf(clickedText)
                    activeIndex = index
                    detailBtn.click()
                    clientClickedOnYear(activeIndex)
                })
            })
            showAllBtn.addEventListener("click", function () {
                showAllBtn.classList.add('active')
                detailBtn.classList.remove('active')
                carouselAllDisplayed.classList.remove('hide')
                carouselDetailed.classList.add('hide')
                timelineTexts.forEach((text)=> {
                    text.classList.add('hide')
                })
            })

            
            // Detailed view of timeline
            detailBtn.addEventListener("click", function () {
                detailBtn.classList.add('active')
                showAllBtn.classList.remove('active')
                carouselAllDisplayed.classList.add('hide')
                carouselDetailed.classList.remove('hide')
                timelineTexts.forEach((text)=> {
                    text.classList.remove('hide')
                })
            })
            
            // Client clicked on year
            function clientClickedOnYear(clickedIndex) {
                // Clear active classes from all timeline item
                let newSeat
                seatsArray.forEach((item, index) => {               // Detailed view
                    item.classList.remove('active')
                    item.classList.remove('is-ref')
                    if(index === clickedIndex) {                    // Set active to clicked element
                        item.classList.add('active')
                        item.style.order = 2
                        if(item.previousElementSibling) {
                            newSeat = item.previousElementSibling
                            // 
                            newSeat.classList.add('is-ref')
                        }
                        if(clickedIndex === 0) {                     // First element
                            const length = seatsArray.length
                            let lastItem = seatsArray[length-1]
                            seatsArray[length-1].classList.add('is-ref')
                            // console.log("🚀 ~ file: slider.html ~ line 241 ~ seatsArray.forEach ~ lastItem", lastItem)
                            lastItem.style.order = 1
                        }
                    }
                })
                seatOfShowAllView.forEach((item, index) => {        // Show all view
                    item.classList.remove('active')
                    if(index === clickedIndex) {                    // Set active to clicked element
                        item.classList.add('active')
                    }
                })
                timelineBoxList.forEach((item, index) => {          // Show all view
                    item.classList.remove('active')
                    if(index === clickedIndex) {                    // Set active to clicked element
                        item.classList.add('active')
                    }
                })
                console.log(clickedIndex, seatsArray.length)
                if (clickedIndex === 0) {
                    handlePrevBtn(true)
                } else if (clickedIndex === seatsArray.length - 1 ) {
                    handleNextBtn(true)
                } else {
                    handlePrevBtn(false)
                    handleNextBtn(false)
                    newSeat.classList.add('is-ref');
                    newSeat.style.order = 1;

                    for (var i = 2; i <= seats.length; i++) {
                        newSeat = next(newSeat);
                        newSeat.style.order = i;
                        console.log('newSeat', newSeat)
                    }
                    
                    function next(el) {
                        if (el.nextElementSibling) {
                            return el.nextElementSibling;
                        } else if(clickedIndex === 0) {
                            return carouselDetailed.lastElementChild
                        } else {
                            return carouselDetailed.firstElementChild;
                        }
                    }
                    
                    function prev(el) {
                        if (el.previousElementSibling) {
                            return el.previousElementSibling;
                        } else {
                            return carouselDetailed.lastElementChild;
                        }
                    }
                    
                }
                
                if(clickedIndex === 0 ) {
                    console.log(carouselDetailed)
                    carouselDetailed.lastElementChild.classList.add('is-ref')
                }
            }
            // Common helper for event delegation.
            function delegate(criteria, listener) {
                return function(e) {
                    const el = e.target;
                    do {
                    if (!criteria(el)) {
                        continue;
                    }
                    e.delegateTarget = el;
                    listener.call(this, e);
                    return;
                    } while ((el = el.parentNode));
                };
            }

            // Custom filter to check for required DOM elements
            function toggleFilter(elem) {
                return (elem instanceof HTMLElement) && elem.matches(".toggle");
                // OR
                // For < IE9
                // return elem.classList && elem.classList.contains('btn');
            }

            // Show description for each year based on array's index
            function showTimelineBox(oldIndex, newIndex) {
                timelineBoxList[oldIndex].classList.remove('active')
                timelineBoxList[newIndex].classList.add('active')
            }
            function handleNextBtn (value) {
                nextBtn.disabled = value
            }
            function handlePrevBtn (value) {
                prevBtn.disabled = value
            }
            // Custom event handler function
            function toggleHandler(e) {
                let prevActiveIndex = activeIndex                   // Get the old index
                var newSeat;
                const el = document.querySelector('.is-ref');
                const currSliderControl = e.delegateTarget;
                // Info: e.target is what triggers the event dispatcher to trigger and e.currentTarget is what you assigned your listener to.
                el.classList.remove('is-ref');
                
                // Next
                function toggleNext () {
                    handlePrevBtn(false)
                    seatsArray[prevActiveIndex].classList.remove('active')
                    seatOfShowAllView[prevActiveIndex].classList.remove('active')
                    newActiveIndex = prevActiveIndex + 1                        // Calculate new index
                    activeIndex = newActiveIndex                                // Set new index
                    seatsArray[newActiveIndex].classList.add('active')
                    seatOfShowAllView[newActiveIndex].classList.add('active')
                    
                    newSeat = next(el);
                    carouselDetailed.classList.remove('is-reversing');
                    showTimelineBox(prevActiveIndex, newActiveIndex)
                }
                // Previous
                function togglePrev () {
                    seatsArray[prevActiveIndex].classList.remove('active')
                    seatOfShowAllView[prevActiveIndex].classList.remove('active')
                    newActiveIndex = prevActiveIndex >= 1 ? prevActiveIndex - 1 : 0
                    activeIndex = newActiveIndex
                    seatsArray[newActiveIndex].classList.add('active')
                    seatOfShowAllView[newActiveIndex].classList.add('active')
                    newSeat = prev(el);
                    carouselDetailed.classList.add('is-reversing');
                    showTimelineBox(prevActiveIndex, newActiveIndex)
                }

                // Disable Arrow button
                if (prevActiveIndex - 1 === 0) {
                    handleNextBtn(false)
                    handlePrevBtn(true)
                } else if (prevActiveIndex + 2 === seatsArray.length) {
                    handleNextBtn(true)
                    handlePrevBtn(false)
                } else {
                    handleNextBtn(false)
                    handlePrevBtn(false)
                }

                // Handle Next/Previous button
                if (currSliderControl.getAttribute('data-toggle') === 'next') {
                    toggleNext()
                } else if(currSliderControl.getAttribute('data-toggle') === 'prev'){
                    togglePrev()
                }
                
                newSeat.classList.add('is-ref');
                newSeat.style.order = 1;
                
                for (var i = 2; i <= seats.length; i++) {
                    newSeat = next(newSeat);
                    newSeat.style.order = i;
                }
                
                carouselDetailed.classList.remove('is-set');
                return setTimeout(function() {
                    return carouselDetailed.classList.add('is-set');
                }, 50);
                
                function next(el) {
                    if (el.nextElementSibling) {
                        return el.nextElementSibling;
                    } else {
                        return carouselDetailed.firstElementChild;
                    }
                }
                
                function prev(el) {
                    if (el.previousElementSibling) {
                        return el.previousElementSibling;
                    } else {
                        return carouselDetailed.lastElementChild;
                    }
                }
            }

        </script>
    </body>
</html>
